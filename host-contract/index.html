<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>StudyNest Education 監護服務合約</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Dancing+Script:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Calibri', 'Noto Sans SC', sans-serif;
            line-height: 1.4;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            font-size: 14px;
        }
        
        .chinese-text, [lang="zh"] {
            font-family: 'Noto Sans SC', 'Microsoft YaHei', '微軟雅黑', sans-serif;
        }
        
        .english-text, [lang="en"] {
            font-family: 'Calibri', 'Times New Roman', serif;
        }
        
        .contract-container {
            max-width: 900px;
            margin: 20px auto;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .letterhead {
            background: linear-gradient(135deg, #2c5282 0%, #2d3748 50%, #1a365d 100%);
            color: white;
            padding: 20px 40px;
            text-align: center;
            position: relative;
        }
        
        .letterhead::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 80%, rgba(237, 137, 54, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(56, 178, 172, 0.1) 0%, transparent 50%);
            opacity: 0.6;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #a2a8bd 0%, #8792a8 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .logo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%);
            border-radius: 50%;
        }
        
        .nest-logo {
            width: 35px;
            height: 35px;
            position: relative;
        }
        
        /* Create the nest bowl shape */
        .nest-bowl {
            width: 22px;
            height: 12px;
            border: 2px solid #ed8936;
            border-top: none;
            border-radius: 0 0 12px 12px;
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .nest-bowl::before {
            content: '';
            position: absolute;
            width: 18px;
            height: 2px;
            background: #ed8936;
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 1px;
        }
        
        .nest-bowl::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 1px;
            background: #ed8936;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 1px;
        }
        
        /* Create the leaf */
        .nest-leaf {
            width: 6px;
            height: 10px;
            background: #38b2ac;
            border-radius: 0 100% 0 100%;
            position: absolute;
            top: 4px;
            left: 50%;
            transform: translateX(-50%) rotate(15deg);
        }
        
        /* Create the book */
        .nest-book {
            width: 18px;
            height: 4px;
            background: #2b6cb0;
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 1px;
        }
        
        .nest-book::before {
            content: '';
            position: absolute;
            width: 15px;
            height: 3px;
            background: #3182ce;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 1px;
        }
        
        .title-section {
            text-align: left;
            flex-grow: 1;
        }

        .letterhead h1 {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            letter-spacing: 0.5px;
            color: white;
        }
        
        .letterhead .chinese-title {
            font-size: 1.3em;
            font-weight: 600;
            position: relative;
            z-index: 1;
            margin-bottom: 0;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
        }
        
        .letterhead .contact-info {
            margin-top: 10px;
            font-size: 0.95em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            font-weight: 400;
            text-align: center;
        }
        
        .contact-info a {
            color: #f6ad55;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .contact-info a:hover {
            color: #ed8936;
            text-shadow: 0 0 8px rgba(237, 137, 54, 0.5);
        }
        
        .contract-content {
            padding: 30px;
        }
        
        .review-date {
            text-align: right;
            margin-bottom: 30px;
            font-style: italic;
            color: #666;
        }
        
        h1, h2, h3 {
            color: #2d3748;
            margin: 20px 0 15px 0;
        }
        
        h1 {
            font-size: 1.6em;
            border-bottom: 3px solid #ed8936;
            padding-bottom: 10px;
        }
        
        h2 {
            font-size: 1.3em;
            color: #2c5282;
        }
        
        h3 {
            font-size: 1.1em;
            color: #2d3748;
        }
        
        .parties-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border: 2px solid #ddd;
        }
        
        .parties-table td, .parties-table th {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: left;
            vertical-align: middle;
        }
        
        .parties-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }

        .input-field {
            width: 100%;
            padding: 6px 10px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-family: inherit;
            font-size: 13px;
            transition: border-color 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            transition: background-color 0.3s ease;
            font-size: 13px;
        }
        
        .checkbox-group:hover {
            background: #e9ecef;
        }
        
        .checkbox-group input[type="checkbox"] {
            margin-right: 12px;
            transform: scale(1.2);
            accent-color: #667eea;
        }
        
        .service-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            border: 2px solid #ddd;
            font-size: 12px;
        }
        
        .service-table th, .service-table td {
            border: 1px solid #ddd;
            padding: 6px 8px;
            text-align: left;
            vertical-align: top;
        }
        
        .service-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }
        
        .service-table .check-mark {
            text-align: center;
            font-size: 1.2em;
            color: #28a745;
        }
        
        .signature-section {
            margin: 40px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #667eea;
        }
        
        .signature-pad {
            width: 100%;
            height: 120px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 10px 0;
            background: white;
            cursor: crosshair;
            display: block;
            touch-action: none;
        }
        
        .signature-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-family: inherit;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-1px);
        }
        
        .final-actions {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 20px;
            border-top: 3px solid #667eea;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .medical-form {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }
        
        .fees-highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .validation-error {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1) !important;
        }
        
        .error-message {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .signature-status {
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            display: none;
        }

        .signature-status.signed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .signature-status.empty {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        @media print {
            .final-actions {
                display: none;
            }
            
            .contract-container {
                box-shadow: none;
                margin: 0;
            }
            
            body {
                background: white;
            }
        }
        
        .elegant-signature {
            font-family: 'Dancing Script', cursive;
            font-size: 2.2em;
            font-weight: 600;
            color: #2c5282;
            text-align: center;
            margin: 10px 0;
            transform: rotate(-2deg);
        }
        
        .chinese-text {
            font-family: 'Noto Sans SC', sans-serif;
            font-weight: 400;
        }
</style>
</head>
<body>
<div class="contract-container">
<div class="letterhead">
<div class="logo-container">
<div class="logo" style="width: 100px; height: 100px; background: rgba(255, 255, 255, 0.5);">
<img alt="StudyNest Education Logo" src="StudyNest Education.png" style="width: 65px; height: 65px; object-fit: contain;"/>
</div>
<div class="title-section">
<h1>StudyNest Education</h1>
</div>
</div>
</div>
<div class="contract-content">
<div class="review-date">
<strong>Review Date：August 2025</strong>
</div>
<h1 style="text-align: center;">Short-Term Host Family Agreement</h1>
<h2>Agreement Parties</h2>
<table class="parties-table">
<tr>
<th style="width: 20%;">
<div style="font-size: 0.9em; line-height: 1.3;">
<div><strong>Party A:</strong></div>
</div>
</th>
<td style="width: 40%;">
<input class="input-field" id="parentName" placeholder="Host Family Representative" required="" type="text"/>
</td>
<td style="width: 40%; font-size: 0.85em; line-height: 1.4;">
<div>(hereinafter referred to as <strong>the Host</strong>)</div>
</td>
</tr>
<tr>
<td style="font-size: 0.9em; line-height: 1.3;">
<div><strong>Address:</strong></div>
</td>
<td colspan="2">
<textarea class="input-field" id="parentAddress" placeholder="Please enter full address" required="" rows="3"></textarea>
</td>
</tr>
<tr>
<th style="font-size: 0.9em; line-height: 1.3;">
<div><strong>Party B:</strong></div>
</th>
<td><strong>StudyNest Education Limited</strong></td>
<td style="font-size: 0.85em; line-height: 1.4;">
<div>(hereinafter referred to as <strong>StudyNest</strong> or <strong>the Company</strong>)</div>
</td>
</tr>
<tr>
<td style="font-size: 0.9em; line-height: 1.3;">
<div><strong>Address:</strong></div>
</td>
<td colspan="2"><strong>1 Boleyn Way, Barnet, EN5 5LH</strong></td>
</tr>
<tr>
<td style="font-size: 0.9em; line-height: 1.3;">
<div><strong>Contract No.:</strong></div>
</td>
<td colspan="2">
<input class="input-field" id="contractNumberInput" placeholder="Contract number will be auto-generated" readonly="" style="background-color: #f8f9fa; color: #6c757d;" type="text"/>
</td>
</tr>
<tr>
<td style="font-size: 0.9em; line-height: 1.3;">
<div><strong>Date of Signing:</strong></div>
</td>
<td colspan="2">
<input class="input-field" id="signingDate" readonly="" required="" type="date"/>
</td>
</tr>
</table>
<p>By signing this Agreement, both parties agree to abide by the following terms and conditions, including the appended Host Family Responsibilities and Legal Provisions.</p>

<h2>Purpose and Scope</h2>
<div style="padding-left: 20px;">
<p>This Agreement governs the provision of short-term accommodation to students under the care of StudyNest Education Ltd. Placements may include weekends, half-terms, exeats, or emergency situations.</span></p>
<p>The primary aim is to ensure:</span></p>
        <ul style="margin-left: 40px;">
<li>Student welfare and safeguarding at all times</span></li>
<li>A safe, clean, and appropriate hosting environment</span></li>
<li>Clarity regarding responsibilities, expectations, and conduct</span></li>
</div>

<h2>Booking Process</h2>
<div style="padding-left: 20px;">
<p>All placements are coordinated exclusively by StudyNest Education Ltd.</span></p>
<p>Hosts will be contacted with student details, stay dates, and special requirements.</span></p>
<p>Hosts must respond to confirm availability within 24 hours.</span></p>
<p>The Company reserves the right to reallocate students if timely confirmation is not received.</span></p>
</ul>
</div>

<h2>Host Responsibilities</h2>
<div style="padding-left: 20px;">
<p>The Host Family agrees to:</span></p>
<p><strong>a) </strong> Provide a clean, safe home environment with appropriate facilities</span></p>
<p><strong>b) </strong> Offer a private bedroom (not shared with any family member)</span></p>
<p><strong>c) </strong> Supply three daily meals unless otherwise agreed</span></p>
<p><strong>d) </strong> Supervise the student appropriately and ensure they are never left overnight without an adult</span></p>
<p><strong>e) </strong> Maintain open communication with the Company and promptly report any issues or concerns</span></p>
<p>Students must not:</span></p>
<p><strong>a) </strong> Stay overnight elsewhere without prior written approval from the Company</span></p>
<p><strong>b) </strong> Be left unsupervised overnight under any circumstance</span></p>
<p>If a key is not provided, a responsible adult must be present to allow entry at expected times.</span></p>
</ul>
</div>

<h2>Host Responsibilities</h2>
<div style="padding-left: 20px;">
<p>All residents aged 16+ must undergo enhanced DBS checks.</span></p>
<p>The Host agrees to comply with the Company’s safeguarding policy at all times.</span></p>
<p>Any safeguarding concern must be reported immediately to the Company.</span></p>
<p><strong>Safeguarding Contacts:<strong></span></p>
<p> DSL: Jessie Chang info@studynest.uk </span></p>
</ul>
</div>

<h2>Payments</h2>
<div style="padding-left: 20px;">
<p>Hosts will be paid the agreed nightly rate by bank transfer within 7 working days following the end of the placement.</span></p>
<p>The Company is not liable for reimbursement of incidental expenses (e.g., transportation, entertainment, personal items).</span></p>
</ul>
</div>   

<h2>Cancellations</h2>
<div style="padding-left: 20px;">
<p>If StudyNest cancels a confirmed booking within one week (7 days) prior to the scheduled arrival date, a goodwill cancellation fee of £50 per week of the confirmed booking will be paid to the Host, up to a maximum of £100.</span></p>
<p>No cancellation fee will be payable if cancellation is made more than one week prior to the scheduled arrival.</span></p>
<p>Repeated or unreasonably late cancellations by the Host may result in temporary suspension or removal from the approved host list, at the discretion of StudyNest Education.</span></p>
</ul>
</div>   

<h2>Private Arrangements</h2>
<div style="padding-left: 20px;">
<p>Hosts may not enter into direct or private agreements with students or their families.</span></p>
<p>All placements must be made through StudyNest Education Ltd.</span></p>
<p>Breach of this clause will result in immediate termination and potential legal action.</span></p>
</ul>
</div>   

<h2>Termination</h2>
<div style="padding-left: 20px;">
<p>Either party may terminate this Agreement with 14 days' written notice.</span></p>
<p>The Company reserves the right to terminate the agreement immediately in the event of any safeguarding concern, misconduct, or breach of contract.</span></p>
</ul>
</div>   

<h2>Host Family Responsibilities</h2>
<div style="padding-left: 20px;">
<p>The Host must:</span></p>
<p><strong>1. </strong> Submit enhanced DBS checks (covered by the Company)</span></p>
<p><strong>2. </strong> Subscribe to the DBS Update Service and maintain validity</span></p>
<p><strong>3. </strong> Complete annual safeguarding training (online)</span></p>
<p><strong>4. </strong> Submit a signed medical declaration</span></p>
<p><strong>5. </strong> Provide two character references (one professional)</span></p>
<p><strong>6. </strong> Cooperate with inspections by the Company, AEGIS, or other relevant authorities</span></p>
<p><strong>7. </strong> Provide:</span></p>
        <li>Private bed and study space</span></li>
        <li>Clean linens and towels weekly</span></li>
        <li>Heating, lighting, bathroom access</span></li>
        <li>Three meals daily and appropriate supervision</span></li>
<p><strong>8. </strong> Notify the Company of any changes to household members or conditions</span></p>
<p><strong>9. </strong> Refrain from making any private hosting arrangements with students or families</span></p>
<p><strong>10. </strong> Maintain emergency contact communication and assist students if needed</span></p>
</ul>
</div>

<h2>Legal Provisions</h2>
<div style="padding-left: 20px;">
<p><strong>Indemnity<strong></span></p>
<p>The Host agrees to indemnify StudyNest Education Ltd from all liabilities resulting from negligence, misconduct, or breach of contract.</span></p>
<p><strong>Insurance<strong></span></p>
<p>The Host must maintain appropriate home insurance including third-party liability.</span></p>
<p><strong>Confidentiality & Data Protection<strong></span></p>
<p>All student and Company information must be treated as confidential under GDPR and UK Data Protection Act 2018.</span></p>
<p><strong>Jurisdiction<strong></span></p>
<p>This Agreement is governed by the laws of England and Wales.</span></p>
<p><strong>Enforcement<strong></span></p>
<p>The attached job description and legal provisions form part of this binding agreement.</span></p>
</ul>
</div> 
        
<h2>Payment Information</h2>
<p>To ensure prompt and accurate payment following any short-term hosting arrangement, please provide your bank details below. This information will be used solely for the purpose of transferring agreed fees for completed placements.</p>

<h3>Bank Details</h3>
<table class="parties-table">
  <tr>
    <td style="width: 30%;"><strong>Account Name</strong></td>
    <td style="width: 30%;"><strong>Contact Number</strong></td>
  </tr>
  <tr>
    <td style="width: 30%;"><strong>Sort Code</strong></td>
    <td style="width: 30%;"><strong>Account Number</strong></td>
  </tr>
</table>
        
<h3>Family Contact Details 家長聯絡資料</h3>
<table class="parties-table">
<tr>
<td style="width: 25%;"></td>
<td style="width: 37.5%; text-align: center;"><strong>Mother 母親資料</strong></td>
<td style="width: 37.5%; text-align: center;"><strong>Father 父親資料</strong></td>
</tr>
<tr>
<td><strong>Name 姓名</strong></td>
<td><input class="input-field" id="motherName" placeholder="母親姓名" type="text"/></td>
<td><input class="input-field" id="fatherName" placeholder="父親姓名" type="text"/></td>
</tr>
<tr>
<td><strong>Occupation 職業</strong></td>
<td><input class="input-field" id="motherOccupation" placeholder="母親職業" type="text"/></td>
<td><input class="input-field" id="fatherOccupation" placeholder="父親職業" type="text"/></td>
</tr>
<tr>
<td><strong>Mobile No. 手機號碼</strong></td>
<td><input class="input-field" id="motherMobile" placeholder="母親手機號碼" type="tel"/></td>
<td><input class="input-field" id="fatherMobile" placeholder="父親手機號碼" type="tel"/></td>
</tr>
<tr>
<td><strong>Email Address 郵箱</strong></td>
<td><input class="input-field" id="motherEmail" placeholder="母親郵箱" type="email"/></td>
<td><input class="input-field" id="fatherEmail" placeholder="父親郵箱" type="email"/></td>
</tr>
<tr>
<td><strong>Home Address<br/>家庭地址</strong></td>
<td colspan="2"><textarea class="input-field" id="homeAddress" placeholder="完整家庭地址 Complete Home Address" rows="2"></textarea></td>
</tr>
</table>

<h3>請勾選所需監護方案 Please tick your selected guardianship plan</h3>
<div class="checkbox-group">
<input id="corePlan" name="guardianshipPlan" type="radio" value="core"/>
<label for="corePlan">核心監護方案 Core Guardianship Plan</label>
</div>
<div class="checkbox-group">
<input id="comprehensivePlan" name="guardianshipPlan" type="radio" value="comprehensive"/>
<label for="comprehensivePlan">全面監護方案 Comprehensive Guardianship Plan</label>
</div>
<h2>Appendix A. Service Details 監護方案介紹</h2>
<p>Below are the two carefully designed guardianship plans offered by SchoolsGroup to meet the diverse needs of families and students, providing professional and comprehensive support and protection. Please select the plan that best suits your requirements.</p>
<p class="chinese-text">以下為英倫學居為您精心設計的兩款監護方案，旨在滿足不同家庭和學生的需求，提供專業全面的支持和保障。請根據您的需求選擇最合適的方案。</p>
<table class="service-table">
<thead>
<tr>
<th style="width: 60%;">服務項目 / Services</th>
<th style="width: 20%;">Core 核心方案</th>
<th style="width: 20%;">Comprehensive 全面方案</th>
</tr>
</thead>
<tbody>
<tr>
<td colspan="3" style="background-color: #f0f8ff; font-weight: bold; text-align: center;">🛫 抵英前服務 Pre-arrival Services</td>
</tr>
<tr>
<td>Provide guardian contact to school 提供監護人聯絡訊息給學校</td>
<td class="check-mark">✔️</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Liaise with designated school contact 與學校指定聯絡人實際溝通與信息傳遞</td>
<td class="check-mark">---</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Emergency contact setup &amp; procedures 安排監護人緊急聯絡方式與應變流程說明</td>
<td class="check-mark">✔️</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Visa &amp; official document support 簽證及官方文件簽署協助</td>
<td class="check-mark">✔️</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Pre-departure briefing 行前指導服務，協助學生與家長了解英國生活實務</td>
<td class="check-mark">---</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td colspan="3" style="background-color: #f0f8ff; font-weight: bold; text-align: center;">🏫 抵英後 &amp; 學期中服務 Term-time UK Services</td>
</tr>
<tr>
<td>24/7 emergency support 雙語緊急電話支援（中英雙語）</td>
<td class="check-mark">✔️</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Emergency coordination (at parents' expense) 緊急事件應變（衍生費用由家長承擔）</td>
<td class="check-mark">✔️</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Assist with student finances 協助家長管理學生財務，如定期零用金轉帳安排</td>
<td class="check-mark">✔️</td>
<td class="check-mark">✔️</td>
</tr>
<tr>

<td>UK bank account support 協助學生開設英國銀行帳戶</td>
<td class="check-mark">---</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Holiday homestay &amp; transport arrangement 協助安排假期寄宿家庭及交通接送</td>
<td class="check-mark">---</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Medical support &amp; interpretation 監護人陪同就醫與語言協助</td>
<td class="check-mark">---</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>School/homestay visit on request 根據需求安排學校或寄宿家庭拜訪</td>
<td class="check-mark">---</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Termly online consultations 每學期與學生及家長進行一次線上會談</td>
<td class="check-mark">---</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Academic support coordination 學術支持（選課諮詢、課外活動安排、家教安排）</td>
<td class="check-mark">---</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>University &amp; UCAS guidance 升學諮詢服務（包括UCAS指導、大學申請）</td>
<td class="check-mark">---</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Attend parent's meeting with report 監護人代家長參加家長會並提供報告</td>
<td class="check-mark">---</td>
<td class="check-mark">✔️</td>
</tr>
<tr>
<td>Act as official school contact 作為學生正式校方聯絡人，確保重要訊息不遺漏</td>
<td class="check-mark">---</td>
<td class="check-mark">✔️</td>
</tr>
</tbody>
</table>
<div class="fees-highlight">
<h3 style="color: white !important; font-size: 1.5em; margin-bottom: 15px; font-weight: 700;">Fees and Charges 費用與收費</h3>
<p><strong>Core Guardianship Plan 核心監護方案：£1,047 per year 每年（£349 x 3學期）</strong></p>
<p><strong>Comprehensive Guardianship Plan 全面監護方案：£2,697 per year 每年（£899 x 3學期）</strong></p>
<p>The guardianship fees are charged on an annual basis and cover the full academic year,<br/><span style="display: block; text-align: center; margin-top: 5px;">including all three school terms.</span></p>
<p class="chinese-text">監護費以年度計算，涵蓋整個學年（三學期）的所有服務。</p>
</div>
<div style="background: #f7fafc; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 5px solid #ed8936; border-top: 1px solid #e2e8f0;">
<h4 style="color: #2d3748;">Third-Party Expenses 第三方費用說明</h4>
<p>All other third-party expenses directly incurred are excluded from the guardianship fees and remain the sole responsibility of the Parents, including but not limited to:</p>
<p class="chinese-text">所有其他由第三方直接產生的費用不包含於監護費中，均由家長自行負擔，包含但不限於：</p>
<ul style="margin: 15px 0; padding-left: 25px;">
<li>Third-party service fees and expenses arising from emergency situations (e.g., medical costs, passport reissuance)<br/><span class="chinese-text">緊急事件產生的第三方服務費用及相關支出（如醫療費用、護照補辦等）</span></li>
<li>Holiday homestay accommodation and transportation fees<br/><span class="chinese-text">假期寄宿家庭安排及交通接送費用</span></li>
<li>Costs incurred by guardians accompanying the student for medical treatment<br/><span class="chinese-text">監護人陪同就醫所產生的費用</span></li>
<li>Fees for on-demand tutoring and academic consultation services<br/><span class="chinese-text">按需提供之家教及學術諮詢服務費用</span></li>
<li>Other third-party service fees<br/><span class="chinese-text">其他第三方服務費用</span></li>
</ul>

<p><strong>Additional Expense Arrangement 儲備金安排：</strong></p>
<p>In addition to the termly guardianship fees, a deposit of £1,000 will be collected at the start of the agreement as the student's allowance reserve fund, which will be held and managed by StudyNest for the purpose of covering necessary incidental expenses (e.g. purchase of personal items, emergency needs, transport bookings, etc.). Expenses under £50 will be deducted directly from the student's allowance account. Expenses exceeding £50 will require prior notification and consent from the Parents before payment. When the balance falls below £300, Parents will be notified to top up the fund.</p>
<p class="chinese-text">除每學期之監護服務費外，英倫學居將於首年簽約時收取 £1,000 英鎊 作為學生之儲備零用金，由本公司妥善保管並用於學生在英期間必要的臨時支出（如購買生活用品、緊急應變、交通預訂等）。對於金額低於 £50 英鎊 的第三方費用，將直接從學生零用金帳戶扣除；金額超過 £50 英鎊 的支出，需事先通知並獲得家長書面同意後方可支付。當餘額低於 £300 英鎊 時，我們將主動通知家長進行儲值補充。</p>

        <p><strong>Payment Security 付款安全：</strong></p>
<p>All payments must be made strictly in accordance with the invoices issued by StudyNest on official company letterhead. To prevent fraud, StudyNest only accepts payments made upon receipt of a valid invoice issued on official company letterhead. Payments made outside of this procedure are not recognized as valid, but parents remain obligated to fulfill all payment responsibilities under the agreement.</p>
<p class="chinese-text">所有款項須依據由英倫學居以正式公司信紙開立的發票進行支付。為防範詐騙，英倫學居僅接受在收到正式且有效發票後，依照發票指示進行的付款。若未依此程序付款，英倫學居仍保留追討應付款項的權利。</p>
</div>
<h2>Appendix B: Student Health &amp; Medical Consent 學生健康資訊與醫療授權</h2>
<div class="medical-form">
<p>To support your child's health and safety during their studies in the UK, we need accurate information about their physical and mental well-being. This form helps the school and guardianship company provide appropriate care and support.</p>
<p class="chinese-text">為了保障您孩子在英國求學期間的健康與安全，我們需要您提供準確的身心健康資訊。本表格將協助學校與監護機構提供合適的照護與支持。</p>
<table class="parties-table">
<tr>

<td style="width: 25%;"><strong>Full Name / 全名</strong></td>
<td style="width: 75%;"><input class="input-field" id="medicalName" placeholder="學生全名" type="text"/></td>
</tr>
<tr>
<td><strong>Date of Birth / 出生日期</strong></td>
<td><input class="input-field" id="medicalDOB" type="date"/></td>
</tr>
<tr>
<td><strong>Blood Type / 血型</strong></td>
<td><input class="input-field" id="bloodType" placeholder="血型 (如：A+, B-, O+等)" type="text"/></td>
</tr>
<tr>
<td style="vertical-align: top;"><strong>General Health<br/>一般健康狀況</strong><br/><small>Please describe any existing health issues or concerns.<br/></small></td>
<td><textarea class="input-field" id="generalHealth" placeholder="請詳細描述學生的一般健康狀況，包括任何慢性疾病、正在服用的藥物、或需要特別注意的健康問題..." rows="3"></textarea></td>
</tr>
<tr>
<td style="vertical-align: top;"><strong>Allergies<br/>過敏狀況</strong><br/><small>Please list any allergies.<br/></small></td>
<td><textarea class="input-field" id="allergies" placeholder="請詳細列出所有過敏源，包括食物過敏、藥物過敏、環境過敏（如花粉、塵蟎）、動物過敏等..." rows="3"></textarea></td>
</tr>
<tr>
<td style="vertical-align: top;"><strong>Last Medical Checkup<br/>最近一次體檢時間</strong><br/><small>Date and doctor's contact if applicable.<br/></small></td>
<td><textarea class="input-field" id="lastCheckup" placeholder="最近體檢日期及醫生聯絡方式（例：2024年6月15日，Dr. Smith, Tel: +44...）" rows="2"></textarea></td>
</tr>
<tr>
<td><strong>Dental Care Needed?<br/>是否需要牙科照護？</strong></td>
<td>
<label style="margin-right: 15px;"><input name="dentalCare" style="margin-right: 8px;" type="radio" value="yes"/> Yes 是</label>
<label><input name="dentalCare" style="margin-right: 8px;" type="radio" value="no"/> No 否</label>
</td>
</tr>
<tr>
<td><strong>Chronic Conditions<br/>慢性病或特殊健康狀況</strong></td>
<td>
<label style="margin-right: 15px;"><input name="chronicConditions" style="margin-right: 8px;" type="radio" value="yes"/> Yes 是</label>
<label><input name="chronicConditions" style="margin-right: 8px;" type="radio" value="no"/> No 否</label>
</td>
</tr>
<tr>
<td style="vertical-align: top;">If yes, please specify: <span class="chinese-text">如是，請說明：</span></td>
<td><textarea class="input-field" id="chronicDetails" placeholder="請詳細說明任何慢性疾病或特殊健康狀況，包括診斷日期、治療方法、服用藥物等..." rows="2"></textarea></td>
</tr>
<tr>
<td><strong>Learning Difficulties<br/>學習障礙</strong></td>
<td>
<label style="margin-right: 15px;"><input name="learningDifficulties" style="margin-right: 8px;" type="radio" value="yes"/> Yes 是</label>
<label><input name="learningDifficulties" style="margin-right: 8px;" type="radio" value="no"/> No 否</label>
</td>
</tr>
<tr>
<td style="vertical-align: top;">If yes, please specify: <span class="chinese-text">如是，請說明</span></td>
<td><textarea class="input-field" id="learningDetails" placeholder="請詳細說明學習障礙類型、診斷情況、所需支援等..." rows="2"></textarea></td>
</tr>
<tr>

<td style="vertical-align: top;"><strong>Additional Information<br/>其他重要健康資訊</strong></td>
<td><textarea class="input-field" id="additionalInfo" placeholder="請提供任何其他重要的健康資訊，包括心理健康狀況、特殊需求、緊急聯絡人資訊等..." rows="3"></textarea></td>
</tr>
</table>
<h4>Vaccination Record 疫苗接種紀錄</h4>
<p>Please provide date for each vaccine your child has received. <span class="chinese-text">請填寫孩子已接種疫苗的日期。</span></p>
<table class="parties-table">
<tr>
<th>Vaccine 疫苗</th>
<th>Date 日期</th>
</tr>
<tr>
<td>DTaP/IPV/Hib (Diphtheria, Tetanus, Pertussis, Polio, Hib)<br/><span class="chinese-text">白喉、破傷風、百日咳、脊髓灰質炎、B型流感嗜血桿菌</span></td>
<td><input class="input-field" id="vaccine1" type="date"/></td>
</tr>
<tr>
<td>MMR (Measles, Mumps, Rubella)<br/><span class="chinese-text">麻疹、腮腺炎、風疹</span></td>
<td><input class="input-field" id="vaccine2" type="date"/></td>
</tr>
<tr>
<td>BCG (Tuberculosis)<br/><span class="chinese-text">卡介苗</span></td>
<td><input class="input-field" id="vaccine3" type="date"/></td>
</tr>
<tr>
<td>Meningitis ACWY<br/><span class="chinese-text">腦膜炎菌A、C、W、Y型</span></td>
<td><input class="input-field" id="vaccine4" type="date"/></td>
</tr>
<tr>
<td>Meningitis B<br/><span class="chinese-text">腦膜炎菌B型</span></td>
<td><input class="input-field" id="vaccine5" type="date"/></td>
</tr>
<tr>
<td>HPV (Human Papillomavirus)<br/><span class="chinese-text">人類乳突病毒</span></td>
<td><input class="input-field" id="vaccine6" type="date"/></td>
</tr>
<tr>
<td>Pneumococcal<br/><span class="chinese-text">肺炎球菌</span></td>
<td><input class="input-field" id="vaccine7" type="date"/></td>
</tr>
</table>
</div>
<h2>Signatures and Acknowledgements 簽署及確認</h2>
<h3>聲明與確認 Declaration</h3>
<p><strong>Please tick the box to confirm acceptance 請在每項聲明前方框內勾選以示確認：</strong></p>
<div class="checkbox-group">
<input id="declaration1" required="" type="checkbox"/>
<label for="declaration1">I / We have read and understood all Terms and Conditions as contained in this document including the Appendices.<br/><span class="chinese-text">本人／我們已閱讀並理解本協議及其附件（A與B）中的所有條款。</span></label>
</div>

<div class="checkbox-group">
<input id="declaration2" required="" type="checkbox"/>
<label for="declaration2">I / We have understood and completed the Parental consents section.<br/><span class="chinese-text">本人／我們已了解並完整填寫了家長批准相關部分。</span></label>
</div>
<div class="checkbox-group">
<input id="declaration3" required="" type="checkbox"/>
<label for="declaration3">I / We agree to inform SchoolsGroup Limited UK of any changes to any information requested herein and anything which may affect the care of the student, the Agreement, and StudyNest's ability to discharge its obligations under this Agreement.<br/><span class="chinese-text">本人／我們同意如有本表所要求的資訊變更，或任何可能影響英倫學居履行照顧學生義務與協議內容之情況，將主動告知。</span></label>
</div>
<div class="checkbox-group">
<input id="declaration4" required="" type="checkbox"/>
<label for="declaration4">I / We confirm that we will pay the fees in advance or on receipt of an invoice.<br/><span class="chinese-text">本人／我們確認將提前支付或於收到付款通知後支付相關費用。</span></label>
</div>
<div class="checkbox-group">
<input id="declaration5" required="" type="checkbox"/>
<label for="declaration5">I / We confirm that we have read and understood all the contents of Appendix A and Appendix B. The signature below confirms acceptance.<br/><span class="chinese-text">本人／我們確認已閱讀並理解附件A及附件B的全部內容。以下簽字即為接受。</span></label>
</div>
<div class="checkbox-group">
<input id="declaration6" required="" type="checkbox"/>
<label for="declaration6">I / We agree that this Agreement is governed by the laws of England and Wales, and that any disputes shall be subject to the exclusive jurisdiction of the courts located in the place of StudyNest Education's registration.<br/><span class="chinese-text">本人／我們同意本協議受英格蘭與威爾斯法律管轄，並同意任何爭議應提交至英倫學居註冊所在地具管轄權之法院處理。</span></label>
</div>
<div class="checkbox-group">
<input id="declaration7" required="" type="checkbox"/>
<label for="declaration7">I / We agree to abide by all obligations set out in this Agreement and undertake not to make false claims or defamatory remarks against StudyNest, its staff, host families, or agents that are unrelated to the actual care of the student.<br/><span class="chinese-text">本人／我們同意遵守本協議所載之所有義務，並承諾不對英倫學居、其職員、寄宿家庭或代理人作出與實際照顧學生無關之虛假指控或毀損名譽的行為。</span></label>
</div>
<div style="margin: 30px 0; padding: 20px; background: #f0f8ff; border-radius: 10px; border-left: 5px solid #ed8936;">
<h4 style="color: #2d3748;">Declaration 聲明:</h4>
<p>I declare that the information provided above is true and accurate to the best of my knowledge. I understand that providing false information may affect my child's admission or enrolment. I authorize SchoolsGroup and the school to use this information to ensure proper care for my child.</p>
<p class="chinese-text">本人聲明上述資料均屬真實且正確。明白如有虚假資料，可能影響孩子入學資格。授權英倫學居及學校使用本資訊以保障孩子健康與安全。</p>
</div>

<div class="signature-section">
<h4>家長／監護人簽名（父親 Father）</h4>
<canvas class="signature-pad" id="fatherSignature"></canvas>
<div class="signature-controls">
<button class="btn btn-secondary" onclick="clearSignature('fatherSignature')" type="button">清除 Clear</button>
</div>
<input class="input-field" id="fatherSignatureDate" placeholder="簽名日期 Signature Date" style="margin-top: 10px;" type="text"/>
<div class="signature-status empty">⚠ 請完成簽名 Please complete signature</div>
</div>
<div class="signature-section">
<h4>家長／監護人簽名（母親 Mother）</h4>
<canvas class="signature-pad" id="motherSignature"></canvas>
<div class="signature-controls">
<button class="btn btn-secondary" onclick="clearSignature('motherSignature')" type="button">清除 Clear</button>
</div>
<input class="input-field" id="motherSignatureDate" placeholder="簽名日期 Signature Date" style="margin-top: 10px;" type="text"/>
<div class="signature-status empty">⚠ 請完成簽名 Please complete signature</div>
</div>
<div class="signature-section">
<h4>StudyNest Education 代表簽名</h4>
<div style="text-align: center; padding: 20px; background: white; border: 2px solid #ddd; border-radius: 8px;">
<div class="elegant-signature">Jessie Chang</div>
<p><strong>StudyNest Education Representative</strong></p>
<p>Date: <span id="companySignatureDate"></span></p>
</div>
<!-- 感谢文字 -->
<div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border-left: 5px solid #28a745; text-align: center;">
<h4 style="color: #28a745; margin-bottom: 15px; font-size: 1.2em;">✅ Contract Completion 合約完成</h4>
<p style="margin-bottom: 10px; line-height: 1.6;">
Thank you for completing the online contract. Your electronic signature has been recorded. To finalise the process, please <strong>download the signed PDF</strong> and <strong>return it to StudyNest via email or messaging app</strong> for our records. No further signature is required.
</p>
<p class="chinese-text" style="margin: 0; line-height: 1.6; color: #495057;">
感謝您完成線上合約填寫，您的電子簽名已成功記錄。為完成最終程序，請<strong>下載已簽署的 PDF 合約</strong>並透過<strong>電子郵件或通訊軟體回傳至英倫學居</strong>，以便我們存檔備查。<strong>無需再次簽名。</strong>
</p>
</div>
</div>
<div class="final-actions">
<button class="btn btn-primary" onclick="printContract()" type="button">
                📄 Download Signed Contract 下載已簽署合約
            </button>
</div>
</div>

<script>
// 檢查必要的外部庫是否已載入
function checkLibraries() {
    const missingLibs = [];
    
    if (typeof window.jspdf === 'undefined') {
        missingLibs.push('jsPDF');
    }
    
    if (typeof html2canvas === 'undefined') {
        missingLibs.push('html2canvas');
    }
    
    if (missingLibs.length > 0) {
        console.error('缺少必要的外部庫:', missingLibs.join(', '));
        return false;
    }
    
    return true;
}

// 電子簽名功能類
class SignaturePad {
    constructor(canvas) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        this.isDrawing = false;
        this.hasSignature = false;
        this.lastPos = { x: 0, y: 0 };
        
        this.setupCanvas();
        this.attachEventListeners();
    }
    
    setupCanvas() {
        // 設置canvas尺寸
        const rect = this.canvas.getBoundingClientRect();
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        
        this.canvas.width = rect.width * ratio;
        this.canvas.height = rect.height * ratio;
        
        this.canvas.style.width = rect.width + 'px';
        this.canvas.style.height = rect.height + 'px';
        
        this.ctx.scale(ratio, ratio);
        
        // 設置繪製樣式
        this.ctx.strokeStyle = '#2c3e50';
        this.ctx.lineWidth = 2;
        this.ctx.lineCap = 'round';
        this.ctx.lineJoin = 'round';
        this.ctx.imageSmoothingEnabled = true;
    }
    
    attachEventListeners() {
        // 鼠標事件
        this.canvas.addEventListener('mousedown', (e) => this.startDrawing(e));
        this.canvas.addEventListener('mousemove', (e) => this.draw(e));
        this.canvas.addEventListener('mouseup', () => this.stopDrawing());
        this.canvas.addEventListener('mouseout', () => this.stopDrawing());
        
        // 觸控事件
        this.canvas.addEventListener('touchstart', (e) => this.handleTouch(e));
        this.canvas.addEventListener('touchmove', (e) => this.handleTouch(e));
        this.canvas.addEventListener('touchend', () => this.stopDrawing());
        
        // 防止頁面滾動
        this.canvas.addEventListener('touchstart', (e) => e.preventDefault());
        this.canvas.addEventListener('touchmove', (e) => e.preventDefault());
    }
    
    getPosition(e) {
        const rect = this.canvas.getBoundingClientRect();
        return {
            x: e.clientX - rect.left,
            y: e.clientY - rect.top
        };
    }
    
    startDrawing(e) {
        this.isDrawing = true;
        this.lastPos = this.getPosition(e);
        
        // 開始新路徑
        this.ctx.beginPath();
        this.ctx.moveTo(this.lastPos.x, this.lastPos.y);
    }
    
    draw(e) {
        if (!this.isDrawing) return;
        
        const currentPos = this.getPosition(e);
        
        this.ctx.lineTo(currentPos.x, currentPos.y);
        this.ctx.stroke();
        
        this.lastPos = currentPos;
        this.hasSignature = true;
        this.updateStatus();
    }
    
    stopDrawing() {
        if (this.isDrawing) {
            this.isDrawing = false;
            this.ctx.beginPath(); // 結束當前路徑
        }
    }
    
    handleTouch(e) {
        e.preventDefault();
        const touch = e.touches[0];
        const mouseEvent = new MouseEvent(
            e.type === 'touchstart' ? 'mousedown' : 'mousemove',
            {
                clientX: touch.clientX,
                clientY: touch.clientY
            }
        );
        this.canvas.dispatchEvent(mouseEvent);
    }
    
    clear() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.hasSignature = false;
        this.updateStatus();
    }
    
    isEmpty() {
        return !this.hasSignature;
    }
    
    getDataURL(type = 'image/png') {
        return this.canvas.toDataURL(type);
    }
    
    updateStatus() {
        const statusEl = this.canvas.parentElement.querySelector('.signature-status');
        if (statusEl) {
            if (this.hasSignature) {
                statusEl.className = 'signature-status signed';
                statusEl.textContent = '✓ 簽名已完成 Signature completed';
            } else {
                statusEl.className = 'signature-status empty';
                statusEl.textContent = '⚠ 請完成簽名 Please complete signature';
            }
        }
    }
}

// PDF生成和下載功能類
class ContractPDFGenerator {
    constructor() {
        this.signatures = {};
    }
    
    // 初始化所有簽名板
    initializeSignaturePads() {
        const signatureCanvases = document.querySelectorAll('.signature-pad');
        
        signatureCanvases.forEach(canvas => {
            this.signatures[canvas.id] = new SignaturePad(canvas);
            
            // 添加狀態顯示元素
            if (!canvas.parentElement.querySelector('.signature-status')) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'signature-status empty';
                statusDiv.textContent = '⚠ 請完成簽名 Please complete signature';
                canvas.parentElement.appendChild(statusDiv);
            }
        });
    }
    
    // 清除指定簽名
    clearSignature(canvasId) {
        if (this.signatures[canvasId]) {
            this.signatures[canvasId].clear();
        }
    }
    
    // 驗證表單完整性
    validateForm() {
        const errors = [];
        
        try {
            // 檢查必填欄位
            const requiredFields = [
                { id: 'parentName', name: '家長姓名' },
                { id: 'parentAddress', name: '家長地址' },
                { id: 'studentFirstName', name: '學生名字' },
                { id: 'studentLastName', name: '學生姓氏' },
                { id: 'studentDOB', name: '學生出生日期' },
                { id: 'passportNo', name: '護照號碼' }
            ];
            
            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!element) {
                    console.warn(`必填欄位元素未找到: ${field.id}`);
                    errors.push(`找不到欄位: ${field.name}`);
                } else if (!element.value || !element.value.trim()) {
                    errors.push(`請填寫 ${field.name}`);
                }
            });
            
            // 檢查性別選擇
            const genderChecked = document.querySelector('input[name="gender"]:checked');
            if (!genderChecked) {
                errors.push('請選擇學生性別');
            }
            
            // 檢查監護方案選擇
            const planChecked = document.querySelector('input[name="guardianshipPlan"]:checked');
            if (!planChecked) {
                errors.push('請選擇監護方案');
            }
            
            // 檢查必要的勾選項
            const requiredCheckboxes = [
                'declaration1', 'declaration2', 'declaration3', 
                'declaration4', 'declaration5', 'declaration6', 'declaration7'
            ];
            
            requiredCheckboxes.forEach(checkboxId => {
                const checkbox = document.getElementById(checkboxId);
                if (!checkbox) {
                    console.warn(`勾選項目元素未找到: ${checkboxId}`);
                    errors.push(`找不到勾選項目: ${checkboxId}`);
                } else if (!checkbox.checked) {
                    errors.push(`請勾選聲明項目: ${checkboxId}`);
                }
            });
            
            // 檢查簽名
            if (this.signatures) {
                let signatureErrors = [];
                Object.keys(this.signatures).forEach(signatureId => {
                    if (this.signatures[signatureId] && this.signatures[signatureId].isEmpty()) {
                        const signatureName = signatureId.replace('Signature', '');
                        signatureErrors.push(`請完成${signatureName}簽名`);
                    }
                });
                
                if (signatureErrors.length > 0) {
                    errors.push(...signatureErrors);
                }
            } else {
                errors.push('簽名功能尚未初始化');
            }
            
        } catch (error) {
            console.error('表單驗證時發生錯誤:', error);
            errors.push('表單驗證過程中發生錯誤');
        }
        
        return {
            isValid: errors.length === 0,
            errors: errors
        };
    }
    
    // 生成合約編號
    generateContractNumber() {
        try {
            const firstNameEl = document.getElementById('studentFirstName');
            const lastNameEl = document.getElementById('studentLastName');
            const signingDateEl = document.getElementById('signingDate');
            
            if (!firstNameEl || !lastNameEl || !signingDateEl) {
                console.warn('合約編號生成：必要元素未找到');
                return 'SN-PENDING-COMPLETION';
            }
            
            const firstName = firstNameEl.value?.trim() || '';
            const lastName = lastNameEl.value?.trim() || '';
            const signingDate = signingDateEl.value || '';
            
            if (firstName && lastName && signingDate) {
                const firstInitial = firstName.charAt(0).toUpperCase();
                const lastInitial = lastName.charAt(0).toUpperCase();
                const dateFormatted = signingDate.replace(/-/g, '');
                const randomNum = Math.floor(Math.random() * 900) + 100;
                
                const contractNumber = `SN-${firstInitial}${lastInitial}-${dateFormatted}-${randomNum}`;
                
                // 更新顯示
                const contractNumberInput = document.getElementById('contractNumberInput');
                if (contractNumberInput) {
                    contractNumberInput.value = contractNumber;
                    contractNumberInput.style.backgroundColor = '#e8f5e8';
                    contractNumberInput.style.color = '#2d5a2d';
                } else {
                    console.warn('contractNumberInput 元素未找到');
                }
                
                return contractNumber;
            }
            
            return 'SN-PENDING-COMPLETION';
        } catch (error) {
            console.error('生成合約編號時發生錯誤:', error);
            return 'SN-PENDING-COMPLETION';
        }
    }
    
    // 生成並下載PDF
    async generatePDF() {
        try {
            // 檢查外部庫
            if (!checkLibraries()) {
                alert('系統載入中，請稍後再試...\nSystem loading, please try again later...');
                return;
            }
            
            // 驗證表單
            const validation = this.validateForm();
            if (!validation.isValid) {
                alert('請完成以下項目後再下載合約：\n\n' + validation.errors.join('\n'));
                return;
            }
            
            // 生成合約編號
            this.generateContractNumber();
            
            // 隱藏下載按鈕
            const finalActions = document.querySelector('.final-actions');
            if (finalActions) {
                finalActions.style.display = 'none';
            }
            
            // 顯示載入訊息
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'pdf-loading';
            loadingDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                text-align: center;
                font-family: inherit;
            `;
            loadingDiv.innerHTML = `
                <div style="font-size: 18px; margin-bottom: 15px;">📄 正在生成PDF合約...</div>
                <div style="font-size: 14px; color: #666;">Generating PDF contract...</div>
                <div style="margin-top: 15px;">
                    <div style="width: 200px; height: 4px; background: #f0f0f0; border-radius: 2px; overflow: hidden;">
                        <div style="width: 0%; height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 2px; animation: progress 3s ease-in-out infinite;"></div>
                    </div>
                </div>
                <style>
                    @keyframes progress {
                        0% { width: 0%; }
                        50% { width: 70%; }
                        100% { width: 100%; }
                    }
                </style>
            `;
            document.body.appendChild(loadingDiv);
            
            // 等待一點時間讓UI更新
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // 使用html2canvas捕獲整個合約內容
            const contractContainer = document.querySelector('.contract-container');
            
            const canvas = await html2canvas(contractContainer, {
                scale: 2, // 高品質
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff',
                width: contractContainer.offsetWidth,
                height: contractContainer.offsetHeight,
                scrollX: 0,
                scrollY: 0
            });
            
            // 創建PDF
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });
            
            // 計算圖片尺寸以適應A4
            const imgWidth = 210; // A4寬度
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            
            // 如果內容太長，分頁處理
            let heightLeft = imgHeight;
            let position = 0;
            
            // 添加第一頁
            pdf.addImage(canvas.toDataURL('image/jpeg', 0.95), 'JPEG', 0, position, imgWidth, imgHeight);
            heightLeft -= 297; // A4高度
            
            // 如果需要分頁
            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                pdf.addPage();
                pdf.addImage(canvas.toDataURL('image/jpeg', 0.95), 'JPEG', 0, position, imgWidth, imgHeight);
                heightLeft -= 297;
            }
            
            // 生成檔案名稱
            const contractNumber = this.generateContractNumber();
            const studentName = `${document.getElementById('studentFirstName').value}_${document.getElementById('studentLastName').value}`;
            const fileName = `StudyNest_Contract_${contractNumber}_${studentName}.pdf`;
            
            // 下載PDF
            pdf.save(fileName);
            
            // 移除載入訊息
            document.body.removeChild(loadingDiv);
            
            // 恢復下載按鈕
            if (finalActions) {
                finalActions.style.display = 'flex';
            }
            
            // 顯示成功訊息
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #d4edda;
                color: #155724;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                font-family: inherit;
                border: 1px solid #c3e6cb;
            `;
            successDiv.innerHTML = `
                <div style="font-weight: bold;">✅ PDF合約下載成功！</div>
                <div style="font-size: 12px; margin-top: 5px;">請將檔案回傳給StudyNest Education</div>
            `;
            document.body.appendChild(successDiv);
            
            // 3秒後移除成功訊息
            setTimeout(() => {
                if (document.body.contains(successDiv)) {
                    document.body.removeChild(successDiv);
                }
            }, 3000);
            
        } catch (error) {
            console.error('PDF生成錯誤:', error);
            
            // 移除載入訊息
            const loadingDiv = document.getElementById('pdf-loading');
            if (loadingDiv) {
                document.body.removeChild(loadingDiv);
            }
            
            // 恢復下載按鈕
            const finalActions = document.querySelector('.final-actions');
            if (finalActions) {
                finalActions.style.display = 'flex';
            }
            
            alert('PDF生成失敗，請稍後重試或聯繫技術支援。\nPDF generation failed, please try again or contact technical support.');
        }
    }
}

// 全局實例
let contractPDF = null;

// 頁面載入完成後初始化
document.addEventListener('DOMContentLoaded', function() {
    try {
        // 創建PDF生成器實例
        contractPDF = new ContractPDFGenerator();
        
        // 初始化簽名板
        contractPDF.initializeSignaturePads();
        
        // 設置今天的日期
        const today = new Date();
        const todayString = today.toISOString().split('T')[0];
        const todayDisplay = today.toLocaleDateString('en-GB');
        
        // 安全地設置日期值
        const signingDateEl = document.getElementById('signingDate');
        const companySignatureDateEl = document.getElementById('companySignatureDate');
        const fatherSignatureDateEl = document.getElementById('fatherSignatureDate');
        const motherSignatureDateEl = document.getElementById('motherSignatureDate');
        
        if (signingDateEl) signingDateEl.value = todayString;
        if (companySignatureDateEl) companySignatureDateEl.textContent = todayDisplay;
        if (fatherSignatureDateEl) fatherSignatureDateEl.value = todayDisplay;
        if (motherSignatureDateEl) motherSignatureDateEl.value = todayDisplay;
        
        // 自動同步學生資訊
        const syncStudentInfo = () => {
            try {
                const firstNameEl = document.getElementById('studentFirstName');
                const lastNameEl = document.getElementById('studentLastName');
                const dobEl = document.getElementById('studentDOB');
                const medicalNameEl = document.getElementById('medicalName');
                const medicalDOBEl = document.getElementById('medicalDOB');
                
                const firstName = firstNameEl?.value || '';
                const lastName = lastNameEl?.value || '';
                const dob = dobEl?.value || '';
                
                if (firstName && lastName && medicalNameEl) {
                    medicalNameEl.value = `${firstName} ${lastName}`;
                }
                if (dob && medicalDOBEl) {
                    medicalDOBEl.value = dob;
                }
                
                if (contractPDF) {
                    contractPDF.generateContractNumber();
                }
            } catch (error) {
                console.error('同步學生資訊時發生錯誤:', error);
            }
        };
        
        // 安全地添加事件監聽器
        const studentFirstNameEl = document.getElementById('studentFirstName');
        const studentLastNameEl = document.getElementById('studentLastName');
        const studentDOBEl = document.getElementById('studentDOB');
        const signingDateEl2 = document.getElementById('signingDate');
        
        if (studentFirstNameEl) {
            studentFirstNameEl.addEventListener('input', syncStudentInfo);
        }
        if (studentLastNameEl) {
            studentLastNameEl.addEventListener('input', syncStudentInfo);
        }
        if (studentDOBEl) {
            studentDOBEl.addEventListener('change', syncStudentInfo);
        }
        if (signingDateEl2) {
            signingDateEl2.addEventListener('change', () => {
                if (contractPDF) contractPDF.generateContractNumber();
            });
        }
        
        console.log('✅ 頁面初始化完成');
        
    } catch (error) {
        console.error('頁面初始化時發生錯誤:', error);
    }
});

// 全局函數（供HTML調用）
function clearSignature(canvasId) {
    try {
        if (contractPDF && contractPDF.signatures && contractPDF.signatures[canvasId]) {
            contractPDF.clearSignature(canvasId);
        } else {
            console.warn(`簽名板 ${canvasId} 未找到或未初始化`);
        }
    } catch (error) {
        console.error('清除簽名時發生錯誤:', error);
    }
}

function printContract() {
    try {
        if (contractPDF) {
            contractPDF.generatePDF();
        } else {
            console.error('contractPDF 未初始化');
            alert('系統尚未完全載入，請稍後再試');
        }
    } catch (error) {
        console.error('生成PDF時發生錯誤:', error);
        alert('PDF生成失敗，請稍後重試或聯繫技術支援。');
    }
}

// 窗口大小改變時重新設置canvas
window.addEventListener('resize', function() {
    try {
        if (contractPDF && contractPDF.signatures) {
            setTimeout(() => {
                Object.values(contractPDF.signatures).forEach(signature => {
                    if (signature && signature.setupCanvas) {
                        signature.setupCanvas();
                    }
                });
            }, 100);
        }
    } catch (error) {
        console.error('調整畫布大小時發生錯誤:', error);
    }
});
</script>

</body>
</html>


